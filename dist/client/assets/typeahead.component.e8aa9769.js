import{y as u,K as g,d as v,_ as n,v as h,g as l,h as C}from"./index.53aa1d0b.js";import"./input.styles.d8ea5ccf.js";import{F as E}from"./input.component.90ccfa1d.js";import{S as b}from"./searchbox.controller.44f3eda4.js";import{baseStyles as S}from"./typeahead.styles.4517854c.js";import"./searchbox.styles.7f8a871d.js";import"./common.49548711.js";import"./popover.component.8640b9da.js";import{P as w,C as I}from"./popover.model.e1bbffca.js";import{g as m}from"./getControl.95a7cb9c.js";import{P as _}from"./popover.controller.3d1b8444.js";function f(r,t,e,o){return o.includes(r.charAt(t))&&r.charAt(t)!==e.substring(0,1)}function x(r,t,e,o){let p="";if(r.length>0&&r[0]>-1){let i=r[0];f(t,i,e,o.delimiters)&&i++,p+=`${t.substring(0,i)}`}p+=r.map((i,c)=>{let d="";if(i!==void 0){f(t,i,e,o.delimiters)&&i++,d+=`<mark>${t.substring(i,i+e.length)}</mark>`;let y=r[c+1];f(t,y,e,o.delimiters)&&y++,y>-1&&(d+=t.substring(i+e.length,y))}return d}).join("");let a=r[r.length-1];return a!==void 0&&(f(t,a,e,o.delimiters)&&a++,p+=t.substring(a+e.length)),p}function L(r,t){const e=(t.delimiters.indexOf(r.charAt(0))>-1?[]:[...t.delimiters]).join("|");let o;switch(t.type){case"start_of_word":o=`(?:^|${e})${r}`;break;case"start_with":o=`^(${e})?${r}`;break;case"contains":o=`[.]*${r}`;break}return new RegExp(o,"gi")}class O{constructor(t){this.host=t,this.strategies={start_of_word:{type:"start_of_word",delimiters:[" ","/","-","_"]},start_with:{type:"start_with",delimiters:["/"]},contains:{type:"contains",delimiters:[]}},this.host.addController(this),this.onKeydown=this.onKeydown.bind(this),this.onInput=this.onInput.bind(this),this.onFocusOut=this.onFocusOut.bind(this),this.onChange=this.onChange.bind(this)}hostConnected(){this.host.addEventListener("keydown",this.onKeydown),this.host.addEventListener("input",this.onInput),this.host.addEventListener("focusout",this.onFocusOut),this.host.addEventListener("change",this.onChange)}hostDisconnected(){this.host.removeEventListener("keydown",this.onKeydown),this.host.removeEventListener("input",this.onInput),this.host.removeEventListener("focusout",this.onFocusOut),this.host.removeEventListener("change",this.onChange)}onKeydown(t){this.host.filterStrategy&&t.key===" "&&this.controlItem.value===""&&t.preventDefault()}onFocusOut(){this.host.filterStrategy&&(this.items.find(e=>e.selected)||this.clearInput())}onInput(t){this.host.filterStrategy&&t.inputType&&this.filterOptionsByValue(t.inputType==="deleteContentBackward"&&!this.controlItem.value?"":this.controlItem.value)}hostUpdated(){this.host.filterStrategy&&this.filterValue&&this.filterOptionsByValue(this.controlItem.value)}clearInput(){this.control&&(this.control.value="",this.host.filterStrategy&&this.filterOptionsByValue(this.control.value),this.control.dispatchEvent(new Event(this.control instanceof HTMLSelectElement?"change":"input",{bubbles:!0,composed:!0})))}setEmptyState(t){const e=!!this.host.isEmpty;e!==t&&(this.host.isEmpty=t,this.host.requestUpdate("isEmpty",e))}onChange(){this.filterValue!==this.controlItem.value&&this.filterOptions("",!0)}filterOptions(t="",e){if(!this.host.filterStrategy)return;let o=0;const p=this.strategies[this.host.filterStrategy];this.items.forEach(a=>{const i=a.innerText||a.value;if(i){const c=[...i.matchAll(L(t,p))].map(d=>d.index);a.toggleAttribute("hide",c.length===0),a.hasAttribute("hide")||(a.innerHTML=x(c,i,t,p),o++)}}),e||this.dispatchMatchEvent(o,t),this.setEmptyState(o===0)}filterOptionsByValue(t=""){this.filterValue===t||!this.filterValue&&t===""||(this.filterValue=t,this.filterOptions(t))}dispatchMatchEvent(t,e){var a;let o;if(t===1){const i=this.items.find(d=>!d.hasAttribute("hide"));(((a=i==null?void 0:i.innerText)==null?void 0:a.trim())||(i==null?void 0:i.value)||"").toLowerCase()===e.toLowerCase()&&(o=i)}const p=new CustomEvent(w,{detail:{selected:o},bubbles:!0,composed:!0});this.control.dispatchEvent(p)}get control(){return m(this.host,"input, select")}get filterControl(){return this.host.renderRoot.querySelector("[filterInput]")}get controlItem(){return this.host.hasAttribute("filterSelect")?this.filterControl:this.control}get items(){return Array.from(this.host.querySelectorAll("oryx-option"))}}const T="No results found";class V{constructor(t,e){this.host=t,this.options=e,this.host.addController(this),this.filterController=new O(t),this.popoverController=new _(t,e),this.onInput=this.onInput.bind(this),this.onChange=this.onChange.bind(this),this.onSelect=this.onSelect.bind(this)}hostConnected(){this.host.addEventListener("input",this.onInput),this.host.addEventListener("change",this.onChange),this.host.addEventListener("oryx.select",this.onSelect)}hostDisconnected(){this.host.removeEventListener("input",this.onInput),this.host.removeEventListener("change",this.onChange),this.host.removeEventListener("oryx.select",this.onSelect)}hostUpdated(){this.host.querySelectorAll("oryx-option").forEach(t=>{t.toggleAttribute(I,!0),t.slot||(t.slot="option")}),!this.lastValue&&this.control.value&&(this.lastValue=this.control.value),this.onChange()}renderPopover(){return u`
      <oryx-popover>
        ${g(!this.host.isEmpty,()=>u`<slot name="option"></slot>`)}
        <slot name="empty">
          ${g(this.host.isEmpty,()=>{var t;return u`<div class="placeholder">
                ${(t=this.host.emptyMessage)!=null?t:T}
              </div>`})}
        </slot>
        <slot name="loading">
          ${g(this.host.isLoading,()=>u`<div class="placeholder">
                <oryx-spinner></oryx-spinner>
              </div>`)}
        </slot>
      </oryx-popover>
    `}onInput(){var o;const t=((o=this.typeaheadControl)==null?void 0:o.value)||this.control.value,e=new CustomEvent("oryx.typeahead",{detail:{query:t},bubbles:!0,composed:!0});this.host.dispatchEvent(e)}onChange(){const t=this.control.value;this.popoverController.selectByValue(t,this.lastValue===t),t===""&&(this.lastValue=void 0)}onSelect(t){if(t.detail.selected){const e=this.getValue(t.detail.selected),o=this.getText(t.detail.selected);if(!e)return;this.control.value=e,this.control.dispatchEvent(new Event(this.control instanceof HTMLSelectElement?"change":"input",{bubbles:!0,composed:!0})),o&&this.typeaheadControl&&(this.typeaheadControl.value=o)}}get control(){return m(this.host)}get typeaheadControl(){var t;return(t=this.host.renderRoot)==null?void 0:t.querySelector("[typeaheadInput]")}getValue(t){return t.value}getText(t){var e;return(e=t.innerText)==null?void 0:e.trim()}}let s=class extends v{constructor(){super(...arguments),this.typeaheadController=new V(this),this.formControlController=new E(this),this.searchController=new b(this)}render(){return u`
      ${this.formControlController.render({before:this.searchController.renderPrefix(),after:this.searchController.renderSuffix()})}
      ${this.typeaheadController.renderPopover()}
    `}};s.styles=S;n([h(),l("design:type",String)],s.prototype,"filterStrategy",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"isLoading",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"isEmpty",void 0);n([h(),l("design:type",String)],s.prototype,"emptyMessage",void 0);n([h(),l("design:type",String)],s.prototype,"label",void 0);n([h(),l("design:type",String)],s.prototype,"errorMessage",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"hasError",void 0);n([h(),l("design:type",String)],s.prototype,"prefixIcon",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"prefixFill",void 0);n([h(),l("design:type",String)],s.prototype,"suffixIcon",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"suffixFill",void 0);n([h(),l("design:type",String)],s.prototype,"searchIcon",void 0);n([h(),l("design:type",String)],s.prototype,"searchIconPosition",void 0);n([h(),l("design:type",String)],s.prototype,"clearIcon",void 0);n([h({reflect:!0}),l("design:type",String)],s.prototype,"clearIconPosition",void 0);n([h(),l("design:type",String)],s.prototype,"clearIconAppearance",void 0);s=n([C()],s);const H=Object.freeze(Object.defineProperty({__proto__:null,get TypeaheadComponent(){return s}},Symbol.toStringTag,{value:"Module"}));export{V as T,H as t};
