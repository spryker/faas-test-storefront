import{a as b,b as a,C as y,P as g}from"./popover.model-91d12e3a.js";import"./common-0ee98dc0.js";import{aA as w}from"./index-41c5945f.js";import{i as E}from"./query.util-87342f84.js";import{g as C}from"./getControl-bdad11f5.js";const S=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),A=["button",'input[type="radio"]','input[type="checkbox"]','input[type="submit"]'];class I{constructor(t){this.host=t,this.host.addController(this)}setBoundingBox(t){const e=this.getComputedProperty(this.host,"--oryx-popover-vertical-offset")??0,s=this.getComputedProperty(this.host,"--oryx-popover-maxheight")??b,i=this.getComputedProperty(this.host,"--oryx-popover-maxwidth")??0,{top:o,right:h,bottom:r,left:d,boundingElementWidth:m,boundingElementHeight:f}=this.getAvailableSpace(t),n=getComputedStyle(document.documentElement).direction==="rtl";this.host.toggleAttribute("rtl",n);const u=d<i&&h>d,c=h<i&&d>h;this.host.toggleAttribute("up",r<s&&o>r),this.host.toggleAttribute("end",!n&&u||n&&c),this.host.toggleAttribute("start",!n&&c||n&&u);const v={"--_available-popover-height":`${Math.max(r,o)-Number(e)}px`,"--_available-popover-width-start":`${n?h:d}px`,"--_available-popover-width-end":`${n?d:h}px`,"--_bounding-element-width":`${m}px`,"--_bounding-element-height":`${f}px`};this.setStyleProperties(v)}setStyleProperties(t){for(const e in t)this.host.style.setProperty(e,t[e])}getAvailableSpace(t){const{top:e,left:s,bottom:i,right:o,width:h,height:r}=t.getBoundingClientRect();return{top:e,left:s,bottom:window.innerHeight-i,right:window.innerWidth-o,boundingElementWidth:h,boundingElementHeight:r}}getComputedProperty(t,e){const s=window==null?void 0:window.getComputedStyle(t).getPropertyValue(e);if(!!s)return parseFloat(s)}}const p=-1;class L{constructor(t,e){this.host=t,this.listItemsSelector=e,this.host.addController(this),this.handleKeydown=this.handleKeydown.bind(this),this.clear=this.clear.bind(this)}hostConnected(){this.host.addEventListener("keydown",this.handleKeydown),this.host.addEventListener(a,this.clear)}hostDisconnected(){this.host.removeEventListener("keydown",this.handleKeydown),this.host.removeEventListener(a,this.clear)}clear(){this.highlight=p}get highlight(){return this.items.findIndex(t=>t.hasAttribute("highlight"))}set highlight(t){var s;(s=this.items[this.highlight])==null||s.toggleAttribute("highlight",!1);const e=this.items[t];e&&(e.toggleAttribute("highlight",!0),e.scrollIntoView({block:"nearest"}),setTimeout(()=>{e.scrollIntoView({block:"nearest"})},300))}handleKeydown(t){switch(t.key){case"ArrowUp":t.metaKey?this.move(t,-10,0):this.move(t,-1,this.items.length-1);break;case"ArrowDown":t.metaKey?this.move(t,10,this.items.length-1):this.move(t,1,0);break;case"PageUp":this.move(t,-10,0);break;case"PageDown":this.move(t,10,this.items.length-1);break;case"Home":this.move(t);break;case"End":this.move(t,void 0,this.items.length-1);break}}move(t,e,s=0){t.preventDefault(),this.highlight===p&&(this.highlight=this.selected);let i=this.highlight;e?i=this.highlight+e:i=s,(i<0||i>=this.items.length)&&(i=s),this.highlight=i}get selected(){return this.items.findIndex(t=>t.hasAttribute("selected"))}get items(){return Array.from(this.host.querySelectorAll(this.listItemsSelector))}}class P{constructor(t,e){this.host=t,this.listItemsSelector=e,this.host.addController(this),this.handleMouseup=this.handleMouseup.bind(this)}hostConnected(){this.host.addEventListener("mouseup",this.handleMouseup)}hostDisconnected(){this.host.removeEventListener("mouseup",this.handleMouseup)}deselect(){this.select(-1)}select(t,e){var i;if(this.selected===t)return;(i=this.items.find(o=>o.hasAttribute("selected")))==null||i.removeAttribute("selected");const s=this.items[t];if(s&&(this.selected=t,!e)){const o=new CustomEvent("oryx.select",{detail:{selected:s},bubbles:!0,composed:!0});this.host.dispatchEvent(o)}}handleMouseup(t){const e=this.items.indexOf(t.target);e>-1&&this.select(e)}get selected(){return this.items.findIndex(t=>t.hasAttribute("selected"))}set selected(t){this.items[t].toggleAttribute("selected",!0)}get items(){return Array.from(this.host.querySelectorAll(this.listItemsSelector))}}function k(l,t=300){return Date.now()-l>t}class x{constructor(t,e){this.host=t,this.options=e,this.timeStarted=0,this.keyIsPressed=!1,this.shouldBeFocused=null,this.host.addController(this),this.dimensionController=new I(t),this.handleBlur=this.handleBlur.bind(this),this.handleFocusin=this.handleFocusin.bind(this),this.handleFocusout=this.handleFocusout.bind(this),this.handleMousedown=this.handleMousedown.bind(this),this.handleMouseup=this.handleMouseup.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.handleContentCloseEvent=this.handleContentCloseEvent.bind(this)}async hostConnected(){window.addEventListener("blur",this.handleBlur),this.host.addEventListener(a,this.handleContentCloseEvent),this.host.addEventListener("focusin",this.handleFocusin),this.host.addEventListener("focusout",this.handleFocusout),this.host.addEventListener("mousedown",this.handleMousedown),this.host.addEventListener("mouseup",this.handleMouseup),this.host.addEventListener("keydown",this.handleKeydown),this.host.addEventListener("keyup",this.handleKeyup),this.host.hasAttribute("open")&&(this.host.requestUpdate(),await this.host.updateComplete,this.setBoundingBox())}hostDisconnected(){window.removeEventListener("blur",this.handleBlur),this.host.removeEventListener(a,this.handleContentCloseEvent),this.host.removeEventListener("focusin",this.handleFocusin),this.host.removeEventListener("focusout",this.handleFocusout),this.host.removeEventListener("mousedown",this.handleMousedown),this.host.removeEventListener("mouseup",this.handleMouseup),this.host.removeEventListener("keydown",this.handleKeydown),this.host.removeEventListener("keyup",this.handleKeyup)}handleBlur(){this.skipOpeningOnNextFocus=!0,this.isOpen&&this.toggle(!1)}handleFocusin(){!this.skipOpeningOnNextFocus&&this.options.showOnFocus&&(this.timeStarted=Date.now(),this.toggle(!0)),this.skipOpeningOnNextFocus=!1}async handleFocusout(){this.host.matches(":focus-within")||this.toggle(!1),this.focusShouldBeFocusedMaybe()}handleMousedown(t){if(!E(t.target)&&this.emitterIsInsidePopover(t)){t.preventDefault(),t.stopPropagation();return}S()&&(this.shouldBeFocused=t.composedPath().find(e=>A.some(s=>e instanceof HTMLElement&&e.matches(s)))??null),this.isOpen||(this.timeStarted=Date.now(),this.toggle(!0))}handleMouseup(t){(this.shouldClosePopover(t)||k(this.timeStarted)&&!this.emitterIsInsidePopover(t))&&this.toggle(!1),this.focusShouldBeFocusedMaybe()}handleKeydown(t){if(!this.keyIsPressed)switch(this.keyIsPressed=!0,t.key){case"Enter":case" ":if(this.emitterIsInsidePopover(t)&&!this.shouldClosePopover(t))return;this.toggle();break;case"Escape":this.isOpen&&this.toggle(!1);break;default:t.key==="Meta"&&t.metaKey||t.key==="Tab"||this.toggle(!0)}}handleKeyup(){this.keyIsPressed=!1}handleContentCloseEvent(t){var s;t.target!==this.element&&this.isOpen&&(this.host.toggleAttribute("open",!1),(s=this.element)==null||s.toggleAttribute("show",!1))}toggle(t){var e,s;t??!this.isOpen?this.show():(this.host.toggleAttribute("open",!1),(e=this.element)==null||e.toggleAttribute("show",!1),(s=this.element)==null||s.dispatchEvent(new CustomEvent(a,{composed:!0,bubbles:!0})))}show(){var t;this.isOpen||(this.setBoundingBox(),this.host.toggleAttribute("open",!0),(t=this.element)==null||t.toggleAttribute("show",!0),this.selected>-1&&this.selected===this.highlighted&&setTimeout(()=>{this.items[this.selected].scrollIntoView({block:"nearest"})},100))}emitterIsInsidePopover(t){return t.composedPath().includes(this.element)}setBoundingBox(){this.dimensionController.setBoundingBox(this.options.boundingElement??C(this.host))}shouldClosePopover(t){return t.composedPath().some((e,s,i)=>s<=i.indexOf(this.element)&&e instanceof Element&&e.hasAttribute(y))}focusShouldBeFocusedMaybe(){this.shouldBeFocused&&(this.shouldBeFocused.focus(),this.shouldBeFocused=null)}get isOpen(){var t;return!!((t=this.element)!=null&&t.hasAttribute("show"))}get selected(){return this.items.findIndex(t=>t.hasAttribute("selected"))}get highlighted(){return this.items.findIndex(t=>t.hasAttribute("highlight"))}get element(){return this.host.renderRoot.querySelector(this.options.elementSelector)}get items(){return Array.from(this.host.querySelectorAll(this.options.itemSelector))}}class T{constructor(t,e){this.host=t,this.options=e,this.popoverSelector=w,this.optionsSelector="oryx-option:not([hide])",this.host.addController(this),this.toggleController=new x(t,{elementSelector:this.popoverSelector,itemSelector:this.optionsSelector,showOnFocus:!0,...e}),this.highlightController=new L(t,this.optionsSelector),this.selectedController=new P(t,this.optionsSelector),this.handleKeydown=this.handleKeydown.bind(this),this.handleInput=this.handleInput.bind(this),this.handleSelectEvent=this.handleSelectEvent.bind(this)}hostConnected(){this.host.addEventListener("keydown",this.handleKeydown),this.host.addEventListener("input",this.handleInput),this.host.addEventListener(g,this.handleSelectEvent)}hostDisconnected(){this.host.removeEventListener("keydown",this.handleKeydown),this.host.removeEventListener("input",this.handleInput),this.host.removeEventListener(g,this.handleSelectEvent)}selectByValue(t,e){var i;const s=this.items.findIndex(o=>o.value===t);this.selectedController.select(s,e),this.toggleController.isOpen&&((i=this.items[s])==null||i.scrollIntoView({block:"nearest"}))}handleKeydown(t){switch(t.key){case"Enter":this.toggleController.isOpen&&this.selectedController.select(this.highlightController.highlight);break;case" ":t.target instanceof HTMLElement&&this.isReadonly(t.target)&&(this.toggleController.isOpen&&this.selectedController.select(this.highlightController.highlight),t.preventDefault());break}}handleInput(t){var s;if(!t.inputType)return;const e=t.composedPath()[0];((s=t.target)==null?void 0:s.value)||e instanceof HTMLInputElement&&(e==null?void 0:e.value)?this.toggleController.toggle(!0):this.selectedController.deselect()}handleSelectEvent(t){if(t.detail.selected){const e=this.items.findIndex(s=>s===t.detail.selected);this.selectedController.select(e)}else this.selectedController.deselect()}isReadonly(t){return t instanceof HTMLSelectElement||t instanceof HTMLInputElement&&t.readOnly}get items(){return Array.from(this.host.querySelectorAll(this.optionsSelector))}}export{T as P};
