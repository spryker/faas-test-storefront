{"version":3,"file":"facet-navigation.component.40caea8a.js","sources":["../../../node_modules/@spryker-oryx/search/facet-navigation/src/facet-navigation.styles.js","../../../node_modules/@spryker-oryx/search/facet-navigation/src/facet-navigation.component.js"],"sourcesContent":["import { css } from 'lit';\nexport const facetNavigation = css `\n  oryx-collapsible {\n    width: 100%;\n    border: none;\n  }\n\n  li:has(ul) {\n    display: contents;\n  }\n`;\n//# sourceMappingURL=facet-navigation.styles.js.map","import { ComponentMixin, ContentController, RouterService, } from '@spryker-oryx/experience';\nimport { layoutStyles } from '@spryker-oryx/experience/composition';\nimport { resolve } from '@spryker-oryx/injector';\nimport { asyncValue } from '@spryker-oryx/utilities/lit-rxjs';\nimport { html } from 'lit';\nimport { when } from 'lit/directives/when.js';\nimport { combineLatest, map, startWith, Subject } from 'rxjs';\nimport { FacetListService } from '../../src/services/facet-list.service';\nimport { facetNavigation } from './facet-navigation.styles';\nexport class SearchFacetNavigationComponent extends ComponentMixin() {\n    constructor() {\n        super(...arguments);\n        this.defaultOptions = {\n            valueRenderLimit: 5,\n            expandedItemsCount: 5,\n        };\n        this.options$ = new ContentController(this)\n            .getOptions()\n            .pipe(map((options) => ({ ...this.defaultOptions, ...options })));\n        this.facetListService = resolve(FacetListService);\n        this.routerService = resolve(RouterService);\n        this.renderedFacetElements = new Map();\n        this.facetVisibilityChange = new Subject();\n        this.facets$ = combineLatest([\n            this.facetListService.get(),\n            this.options$,\n            this.facetVisibilityChange.pipe(startWith(null)),\n            this.routerService.activatedRouter(),\n        ]);\n    }\n    renderFacets(facets, options, facetVisibilityChange, activatedRouter) {\n        return html `${facets.map((facet, index) => {\n            this.renderedFacetElements.set(facet.parameter, {\n                renderedItemsCount: 0,\n                isShowAll: facet.parameter === facetVisibilityChange?.parameter\n                    ? facetVisibilityChange.isShowAll\n                    : false,\n            });\n            return html `\n        <oryx-collapsible\n          ?open=${index < options.expandedItemsCount}\n          .appearance=\"inline\"\n          .toggleAppearance=\"iconButton\"\n          .header=${facet.name}\n        >\n          ${when(Array.isArray(facet.values), () => html `\n              ${this.renderFacetValues(facet.values, facet.parameter, options.valueRenderLimit, activatedRouter)}\n              ${this.renderShowHideAllButtons(facet.parameter, this.getFacetValueLength(facet.values))}\n            `, () => this.renderRangeValue(facet.values))}\n        </oryx-collapsible>\n      `;\n        })}`;\n    }\n    renderFacetValues(facets, parameter, valueRenderLimit, activatedRouter) {\n        const renderedFacetElement = this.renderedFacetElements?.get(parameter);\n        return html `\n      <ul>\n        ${facets?.map((f) => {\n            if (this.checkValueRenderLimit(parameter, valueRenderLimit) &&\n                !renderedFacetElement?.isShowAll) {\n                return;\n            }\n            this.renderedFacetElements.set(parameter, {\n                renderedItemsCount: this.renderedFacetElements?.get(parameter).renderedItemsCount +\n                    1,\n                isShowAll: renderedFacetElement?.isShowAll ?? false,\n            });\n            return html `<li>\n              <oryx-link>\n                <a\n                  href=\"${this.routerService.getUrl(activatedRouter.route, {\n                ...activatedRouter.extras,\n                queryParams: {\n                    ...(activatedRouter.extras?.queryParams ?? {}),\n                    [parameter.toLowerCase()]: `${f.value ?? f.name}`,\n                },\n            })}\"\n                >\n                  ${f.name ?? f.value} (${f.count})\n                </a>\n              </oryx-link>\n            </li>\n            ${when(f.children?.length, () => html `<li>\n                  ${this.renderFacetValues(f.children, parameter, valueRenderLimit, activatedRouter)}\n                </li>`)}`;\n        })}\n      </ul>\n    `;\n    }\n    renderRangeValue(rangeFacet) {\n        return html ` ${rangeFacet.max} ${rangeFacet.max} `;\n    }\n    render() {\n        return html `\n      ${asyncValue(this.facets$, ([facets, options, facetVisibilityChange, activatedRouter]) => {\n            return this.renderFacets(facets ?? [], options, facetVisibilityChange, activatedRouter);\n        })}\n    `;\n    }\n    getFacetValueLength(facetValues) {\n        let facetLength = facetValues.length;\n        const calcFacetsLength = (facetList) => {\n            facetList.forEach((f) => {\n                if (f.children?.length) {\n                    facetLength += f.children?.length;\n                    calcFacetsLength(f.children);\n                }\n            });\n        };\n        calcFacetsLength(facetValues);\n        return facetLength;\n    }\n    checkValueRenderLimit(parameter, limit) {\n        const renderedItemsCount = this.renderedFacetElements.get(parameter).renderedItemsCount;\n        return renderedItemsCount >= limit;\n    }\n    renderShowHideAllButtons(parameter, allItems) {\n        const renderedParameter = this.renderedFacetElements.get(parameter);\n        if (renderedParameter.renderedItemsCount >= allItems &&\n            !renderedParameter?.isShowAll) {\n            return;\n        }\n        return renderedParameter.isShowAll\n            ? html `<button\n          @click=${() => this.provideFacetVisibilityChange(parameter, false)}\n        >\n          Hide all\n        </button>`\n            : html `<button\n          @click=${() => this.provideFacetVisibilityChange(parameter, true)}\n        >\n          Show all (${allItems})\n        </button>`;\n    }\n    provideFacetVisibilityChange(parameter, isShowAll) {\n        this.facetVisibilityChange.next({ parameter, isShowAll });\n    }\n}\nSearchFacetNavigationComponent.styles = [layoutStyles, facetNavigation];\n//# sourceMappingURL=facet-navigation.component.js.map"],"names":["facetNavigation","css","SearchFacetNavigationComponent","ComponentMixin","ContentController","map","options","resolve","FacetListService","RouterService","Subject","combineLatest","startWith","facets","facetVisibilityChange","activatedRouter","html","facet","index","when","parameter","valueRenderLimit","renderedFacetElement","_a","f","_b","_d","_c","_e","_f","_g","rangeFacet","asyncValue","facetValues","facetLength","calcFacetsLength","facetList","limit","allItems","renderedParameter","isShowAll","layoutStyles"],"mappings":"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"}