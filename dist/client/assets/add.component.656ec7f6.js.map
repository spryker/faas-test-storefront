{"version":3,"file":"add.component.656ec7f6.js","sources":["../../../node_modules/rxjs/dist/esm5/internal/operators/ignoreElements.js","../../../node_modules/rxjs/dist/esm5/internal/operators/delayWhen.js","../../../node_modules/rxjs/dist/esm5/internal/operators/delay.js","../../../node_modules/@spryker-oryx/cart/add/src/add.styles.js","../../../node_modules/@spryker-oryx/cart/add/src/add.component.js"],"sourcesContent":["import { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nimport { noop } from '../util/noop';\nexport function ignoreElements() {\n    return operate(function (source, subscriber) {\n        source.subscribe(createOperatorSubscriber(subscriber, noop));\n    });\n}\n//# sourceMappingURL=ignoreElements.js.map","import { concat } from '../observable/concat';\nimport { take } from './take';\nimport { ignoreElements } from './ignoreElements';\nimport { mapTo } from './mapTo';\nimport { mergeMap } from './mergeMap';\nexport function delayWhen(delayDurationSelector, subscriptionDelay) {\n    if (subscriptionDelay) {\n        return function (source) {\n            return concat(subscriptionDelay.pipe(take(1), ignoreElements()), source.pipe(delayWhen(delayDurationSelector)));\n        };\n    }\n    return mergeMap(function (value, index) { return delayDurationSelector(value, index).pipe(take(1), mapTo(value)); });\n}\n//# sourceMappingURL=delayWhen.js.map","import { asyncScheduler } from '../scheduler/async';\nimport { delayWhen } from './delayWhen';\nimport { timer } from '../observable/timer';\nexport function delay(due, scheduler) {\n    if (scheduler === void 0) { scheduler = asyncScheduler; }\n    var duration = timer(due, scheduler);\n    return delayWhen(function () { return duration; });\n}\n//# sourceMappingURL=delay.js.map","import { css } from 'lit';\nexport const styles = css `\n  :host {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px 17px;\n  }\n\n  form {\n    display: contents;\n  }\n\n  oryx-button {\n    flex: auto;\n  }\n\n  button {\n    --oryx-icon-size: 24px;\n\n    height: 28px;\n  }\n`;\n//# sourceMappingURL=add.styles.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { CartService } from '@spryker-oryx/cart';\nimport { ContentController } from '@spryker-oryx/experience';\nimport { resolve } from '@spryker-oryx/injector';\nimport { ProductComponentMixin, ProductController, } from '@spryker-oryx/product';\nimport { IconTypes } from '@spryker-oryx/themes/icons';\nimport { ButtonType } from '@spryker-oryx/ui/button';\nimport { Size } from '@spryker-oryx/ui/utilities';\nimport { hydratable } from '@spryker-oryx/utilities';\nimport { i18n } from '@spryker-oryx/utilities/i18n';\nimport { asyncValue, subscribe } from '@spryker-oryx/utilities/lit-rxjs';\nimport { html } from 'lit';\nimport { createRef, ref } from 'lit/directives/ref.js';\nimport { BehaviorSubject, catchError, combineLatest, delay, map, of, shareReplay, Subject, switchMap, tap, withLatestFrom, } from 'rxjs';\nimport { styles } from './add.styles';\nlet CartAddComponent = class CartAddComponent extends ProductComponentMixin() {\n    constructor() {\n        super(...arguments);\n        this.cartService = resolve(CartService);\n        this.options$ = new ContentController(this).getOptions();\n        this.product$ = new ProductController(this).getProduct();\n        this.data$ = combineLatest([\n            this.options$,\n            this.product$,\n            this.cartService.getEntries(),\n        ]).pipe(shareReplay({ bufferSize: 1, refCount: true }));\n        this.min$ = this.data$.pipe(map(([_, product, entries]) => this.calculateMin(product, entries)), shareReplay({ bufferSize: 1, refCount: true }));\n        this.max$ = this.data$.pipe(map(([_, product, entries]) => this.calculateMax(product, entries)), shareReplay({ bufferSize: 1, refCount: true }));\n        this.isBusy$ = new BehaviorSubject(false);\n        this.isQuantityInvalid$ = new BehaviorSubject(false);\n        this.isConfirmed$ = new BehaviorSubject(false);\n        this.isDisabled$ = combineLatest([\n            this.min$.pipe(map((m) => m === 0)),\n            this.isBusy$,\n            this.isConfirmed$,\n            this.isQuantityInvalid$,\n        ]).pipe(map((a) => !!a.find((a) => !!a)));\n        this.triggerEntry$ = new Subject();\n        this.quantityInputRef = createRef();\n        this.add$ = this.triggerEntry$.pipe(tap(() => this.isBusy$.next(true)), withLatestFrom(this.product$), switchMap(([quantity, product]) => \n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.cartService.addEntry({ sku: product.sku, quantity })), tap(() => {\n            this.isBusy$.next(false);\n            this.isConfirmed$.next(true);\n        }), delay(800), tap(() => this.isConfirmed$.next(false)), catchError(() => {\n            this.isBusy$.next(false);\n            return of(null);\n        }));\n    }\n    render() {\n        return html ` ${asyncValue(this.data$, ([options, product]) => product?.sku\n            ? html `${this.renderQuantity(options)} ${this.renderButton(options)}`\n            : html ``)}`;\n    }\n    renderQuantity(options) {\n        if (options.hideQuantityInput) {\n            return html ``;\n        }\n        return html `<oryx-cart-quantity-input\n      ${ref(this.quantityInputRef)}\n      .min=${asyncValue(this.min$)}\n      .value=${asyncValue(this.min$)}\n      .max=${asyncValue(this.max$)}\n      @update=${this.onUpdate}\n      @submit=${this.onSubmit}\n    ></oryx-cart-quantity-input>`;\n    }\n    renderButton(options) {\n        return html ` <oryx-button\n      size=${Size.small}\n      ?loading=${asyncValue(this.isBusy$)}\n      ?confirmed=${asyncValue(this.isConfirmed$)}\n      type=${ButtonType.Primary}\n      ?outline=${options.outlined}\n    >\n      <button\n        ?disabled=${asyncValue(this.isDisabled$)}\n        ?inert=${asyncValue(this.isBusy$)}\n        @click=${this.onSubmit}\n      >\n        <oryx-icon .type=${IconTypes.CartAdd} size=${Size.large}></oryx-icon>\n        ${i18n('cart.add-to-cart')}\n      </button>\n    </oryx-button>`;\n    }\n    /**\n     * Returns 0 when the max available quantity is smaller than the min order quantity.\n     */\n    calculateMin(product, entries) {\n        const maxAvailable = this.calculateMax(product, entries);\n        const minOrderQuantity = 1;\n        return maxAvailable !== undefined && maxAvailable < minOrderQuantity\n            ? 0\n            : minOrderQuantity;\n    }\n    /**\n     * When the product has a maximum quantity defined, we take the cumulated quantity from\n     * the active cart, and subtract this number from the available quantity.\n     */\n    calculateMax(product, entries) {\n        const cumulatedEntryCount = entries\n            .filter((entry) => entry.sku === product?.sku)\n            .map((entry) => entry.quantity)\n            .reduce((a, b) => a + b, 0);\n        return product?.availability?.quantity\n            ? product?.availability?.quantity - cumulatedEntryCount\n            : undefined;\n    }\n    onUpdate(e) {\n        this.isQuantityInvalid$.next(!!e.detail.isInvalid);\n    }\n    onSubmit(e) {\n        this.triggerEntry$.next(e.detail?.quantity ??\n            this.quantityInputRef.value?.value ??\n            1);\n    }\n};\nCartAddComponent.styles = styles;\n__decorate([\n    subscribe(),\n    __metadata(\"design:type\", Object)\n], CartAddComponent.prototype, \"add$\", void 0);\nCartAddComponent = __decorate([\n    hydratable(['click', 'focusin'])\n], CartAddComponent);\nexport { CartAddComponent };\n//# sourceMappingURL=add.component.js.map"],"names":["ignoreElements","operate","source","subscriber","createOperatorSubscriber","noop","delayWhen","delayDurationSelector","subscriptionDelay","concat","take","mergeMap","value","index","mapTo","delay","due","scheduler","asyncScheduler","duration","timer","styles","css","CartAddComponent","ProductComponentMixin","resolve","CartService","ContentController","ProductController","combineLatest","shareReplay","map","_","product","entries","BehaviorSubject","m","a","Subject","createRef","tap","withLatestFrom","switchMap","quantity","catchError","of","html","asyncValue","options","ref","Size","ButtonType","IconTypes","i18n","maxAvailable","minOrderQuantity","cumulatedEntryCount","entry","_a","_b","e","_d","_c","__decorate","subscribe","__metadata","hydratable"],"mappings":"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"}