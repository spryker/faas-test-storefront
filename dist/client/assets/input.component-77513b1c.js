import{y as l,d as c,_ as r,v as o,g as i}from"./index-4d2c92b7.js";import{q as a,i as f}from"./query.util-00243645.js";import{b}from"./input.styles-6d634215.js";import{g as p}from"./getControl-ea6b3b29.js";class g{constructor(t){this.host=t,this.host.addController(this)}hostUpdated(){this.updateFill()}renderPrefix(t){if(t)this.host.setAttribute("has-prefix","");else{const e=this.host.prefixIcon;this.hasContent("prefix",e)&&(t=l`<oryx-icon .type="${e}"></oryx-icon>`,this.host.setAttribute("has-prefix",""))}return this.renderContent("prefix",t)}renderSuffix(t){let e;const n=this.host.suffixIcon;return this.hasContent("suffix",n)&&(e=l`<oryx-icon .type="${n}"></oryx-icon>`),this.renderContent("suffix",l`${t}${e}`)}renderContent(t,e){return l`<slot name=${t}>${e}</slot>`}updateFill(){this.host.toggleAttribute("prefixFill",!!this.host.prefixFill&&(!!this.host.prefixIcon||a(this.host,{slot:"prefix",flatten:!0})?.length>0)),this.host.toggleAttribute("suffixFill",!!this.host.suffixFill&&(!!this.host.suffixIcon||a(this.host,{slot:"suffix",flatten:!0})?.length>0))}hasContent(t,e){return!!e||this.host?.querySelectorAll?.(`*[slot=${t}]`)?.length>0}}class m{constructor(t){this.host=t,this.host.addController(this)}hostUpdated(){this.handleError()}render(){return l`<oryx-error-message .message=${this.message}>
      <slot name="error" @slotchange=${this.handleError.bind(this)}></slot>
    </oryx-error-message>`}handleError(){const t=!!this.message||this.errorSlot.length>0,e=this.host.shadowRoot.querySelector("oryx-error-message"),n=e?.hasAttribute("hasErrorContent");e?.toggleAttribute("hasErrorContent",t),(!this.host.hasAttribute("hasError")||n)&&this.host.toggleAttribute("hasError",t)}get message(){return this.host.errorMessage}get errorSlot(){return this.host.querySelectorAll("[slot=error]")}}const v=["a[href]","button","[tabindex]","input","select","textarea"];class y{constructor(t){this.host=t,this.host.addController(this)}hostConnected(){this.setupVisibleFocusHandlers()}setupVisibleFocusHandlers(){const t=()=>{this.mouseWasUsed=void 0,this.host.removeAttribute("visible-focus"),this.focusableElements().forEach(e=>{e.removeEventListener("blur",t)})};this.host.addEventListener("mousedown",()=>{this.mouseWasUsed=!0,this.host.removeAttribute("visible-focus"),this.focusableElements().forEach(e=>{e.addEventListener("blur",()=>t())})}),this.host.addEventListener("keyup",()=>{this.mouseWasUsed||this.host.toggleAttribute("visible-focus",!0),this.focusableElements().forEach(e=>{e.addEventListener("blur",()=>t())})})}focusableElements(){return a(this.host,{selector:v.join(","),flatten:!0})}}class E{constructor(t){this.host=t,this._attributes=["disabled","readonly"],this._listeners=[],this.host.addController(this),this.visibleFocusController=new y(this.host),this.errorController=new m(this.host),this.mouseDownHandler=this.mouseDownHandler.bind(this),this.setHasErrorAttr=this.setHasErrorAttr.bind(this),this.removeHasErrorAttr=this.removeHasErrorAttr.bind(this)}hostConnected(){this.host.addEventListener("mousedown",this.mouseDownHandler)}hostUpdated(){const t=this.host.renderRoot.querySelector('slot[name="prefix"]');this.host.style.setProperty("--float-label-start-gap",`${t?.offsetWidth}px`)}hostDisconnected(){this.removeValidationListeners(),this.host.removeEventListener("mousedown",this.mouseDownHandler),this.controlAttrObserver?.disconnect()}mouseDownHandler(t){f(t.target)||(t.target===this.host&&t.preventDefault(),this.control.focus())}render(t={}){return l`
      <label>
        <slot name="label" part="label">${this.host.label}</slot>
        <div class="control">
          ${t.before}
          <slot
            @slotchange=${()=>this.handleSlotChange()}
            @input=${()=>this.toggleHasValueAttribute()}
          >
            <input />
          </slot>
          ${t.after}
        </div>
      </label>
      ${this.errorController.render()}
    `}handleSlotChange(){this.detectAutofill(),this.toggleHasValueAttribute(),this.adjustDisabledState(),this.addValidationListeners()}setHasErrorAttr(){this.host.toggleAttribute("hasError",!0)}removeHasErrorAttr(){this.host.toggleAttribute("hasError",!1)}addValidationListeners(){this.control?.addEventListener("invalid",this.setHasErrorAttr),this.control?.addEventListener("input",this.removeHasErrorAttr)}removeValidationListeners(){this.control?.removeEventListener("invalid",this.setHasErrorAttr),this.control?.removeEventListener("input",this.removeHasErrorAttr)}detectAutofill(){let t=30;const e=setInterval(()=>{t===0&&clearInterval(e),t--;try{this.control.matches(":-webkit-autofill")&&(this.host.toggleAttribute("has-value",!0),clearInterval(e))}catch{clearInterval(e)}},30)}toggleHasValueAttribute(){this.host.toggleAttribute("has-value",!!this.control.value)}adjustDisabledState(){this.host.toggleAttribute("disabled",this.control.disabled),this.registerListener({attributes:["disabled","readonly"]},()=>{this.host.toggleAttribute("disabled",this.control.disabled)})}registerListener(t,e){this._attributes=[...this._attributes,...t.attributes],this._listeners.push(e),this.controlAttrObserver?.disconnect(),this.controlAttrObserver=new MutationObserver((n,u)=>{this._listeners.forEach(d=>d(n,u))}),this.controlAttrObserver.observe(this.control,{attributeFilter:this._attributes})}get control(){return p(this.host)}}class s extends c{constructor(){super(...arguments),this.formControlController=new E(this),this.affixController=new g(this)}static{this.styles=b}render(){return l`${this.formControlController.render({before:this.affixController.renderPrefix(),after:this.affixController.renderSuffix()})}`}}r([o({type:Boolean,reflect:!0}),i("design:type",Boolean)],s.prototype,"floatLabel",void 0);r([o(),i("design:type",String)],s.prototype,"label",void 0);r([o(),i("design:type",String)],s.prototype,"errorMessage",void 0);r([o({type:Boolean,reflect:!0}),i("design:type",Boolean)],s.prototype,"hasError",void 0);r([o(),i("design:type",String)],s.prototype,"prefixIcon",void 0);r([o({type:Boolean,reflect:!0}),i("design:type",Boolean)],s.prototype,"prefixFill",void 0);r([o(),i("design:type",String)],s.prototype,"suffixIcon",void 0);r([o({type:Boolean,reflect:!0}),i("design:type",Boolean)],s.prototype,"suffixFill",void 0);const S=Object.freeze(Object.defineProperty({__proto__:null,InputComponent:s},Symbol.toStringTag,{value:"Module"}));export{g as A,m as E,E as F,S as i};
