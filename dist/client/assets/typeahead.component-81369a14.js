import{y as u,K as m,d as C,_ as n,v as h,g as l,h as E}from"./index-41c5945f.js";import"./input.styles-dce2c601.js";import{F as b}from"./input.component-729fa045.js";import{S}from"./searchbox.controller-5f002bd8.js";import{baseStyles as w}from"./typeahead.styles-97be0c04.js";import"./searchbox.styles-7e993ee0.js";import"./common-0ee98dc0.js";import"./popover.component-c449afef.js";import{P as I,C as x}from"./popover.model-91d12e3a.js";import{g as v}from"./getControl-bdad11f5.js";import{P as L}from"./popover.controller-82a090e4.js";function g(r,t,e,o){return o.includes(r.charAt(t))&&r.charAt(t)!==e.substring(0,1)}function _(r,t,e,o){let p="";if(r.length>0&&r[0]>-1){let i=r[0];g(t,i,e,o.delimiters)&&i++,p+=`${t.substring(0,i)}`}p+=r.map((i,c)=>{let d="";if(i!==void 0){g(t,i,e,o.delimiters)&&i++,d+=`<mark>${t.substring(i,i+e.length)}</mark>`;let f=r[c+1];g(t,f,e,o.delimiters)&&f++,f>-1&&(d+=t.substring(i+e.length,f))}return d}).join("");let a=r[r.length-1];return a!==void 0&&(g(t,a,e,o.delimiters)&&a++,p+=t.substring(a+e.length)),p}function O(r,t){const e=(t.delimiters.indexOf(r.charAt(0))>-1?[]:[...t.delimiters]).join("|");let o;switch(t.type){case"start_of_word":o=`(?:^|${e})${r}`;break;case"start_with":o=`^(${e})?${r}`;break;case"contains":o=`[.]*${r}`;break}return new RegExp(o,"gi")}class T{constructor(t){this.host=t,this.strategies={start_of_word:{type:"start_of_word",delimiters:[" ","/","-","_"]},start_with:{type:"start_with",delimiters:["/"]},contains:{type:"contains",delimiters:[]}},this.host.addController(this),this.onKeydown=this.onKeydown.bind(this),this.onInput=this.onInput.bind(this),this.onFocusOut=this.onFocusOut.bind(this),this.onChange=this.onChange.bind(this)}hostConnected(){this.host.addEventListener("keydown",this.onKeydown),this.host.addEventListener("input",this.onInput),this.host.addEventListener("focusout",this.onFocusOut),this.host.addEventListener("change",this.onChange)}hostDisconnected(){this.host.removeEventListener("keydown",this.onKeydown),this.host.removeEventListener("input",this.onInput),this.host.removeEventListener("focusout",this.onFocusOut),this.host.removeEventListener("change",this.onChange)}onKeydown(t){this.host.filterStrategy&&t.key===" "&&this.controlItem.value===""&&t.preventDefault()}onFocusOut(){this.host.filterStrategy&&(this.items.find(e=>e.selected)||this.clearInput())}onInput(t){this.host.filterStrategy&&t.inputType&&this.filterOptionsByValue(t.inputType==="deleteContentBackward"&&!this.controlItem.value?"":this.controlItem.value)}hostUpdated(){this.host.filterStrategy&&this.filterValue&&this.filterOptionsByValue(this.controlItem.value)}clearInput(){this.control&&(this.control.value="",this.host.filterStrategy&&this.filterOptionsByValue(this.control.value),this.control.dispatchEvent(new Event(this.control instanceof HTMLSelectElement?"change":"input",{bubbles:!0,composed:!0})))}setEmptyState(t){const e=!!this.host.isEmpty;e!==t&&(this.host.isEmpty=t,this.host.requestUpdate("isEmpty",e))}onChange(){this.filterValue!==this.controlItem.value&&this.filterOptions("",!0)}filterOptions(t="",e){if(!this.host.filterStrategy)return;let o=0;const p=this.strategies[this.host.filterStrategy];this.items.forEach(a=>{const i=a.innerText||a.value;if(i){const c=[...i.matchAll(O(t,p))].map(d=>d.index);a.toggleAttribute("hide",c.length===0),a.hasAttribute("hide")||(a.innerHTML=_(c,i,t,p),o++)}}),e||this.dispatchMatchEvent(o,t),this.setEmptyState(o===0)}filterOptionsByValue(t=""){this.filterValue===t||!this.filterValue&&t===""||(this.filterValue=t,this.filterOptions(t))}dispatchMatchEvent(t,e){var a;let o;if(t===1){const i=this.items.find(d=>!d.hasAttribute("hide"));(((a=i==null?void 0:i.innerText)==null?void 0:a.trim())||(i==null?void 0:i.value)||"").toLowerCase()===e.toLowerCase()&&(o=i)}const p=new CustomEvent(I,{detail:{selected:o},bubbles:!0,composed:!0});this.control.dispatchEvent(p)}get control(){return v(this.host,"input, select")}get filterControl(){return this.host.renderRoot.querySelector("[filterInput]")}get controlItem(){return this.host.hasAttribute("filterSelect")?this.filterControl:this.control}get items(){return Array.from(this.host.querySelectorAll("oryx-option"))}}const V="No results found";class B{constructor(t,e){this.host=t,this.options=e,this.host.addController(this),this.filterController=new T(t),this.popoverController=new L(t,e),this.onInput=this.onInput.bind(this),this.onChange=this.onChange.bind(this),this.onSelect=this.onSelect.bind(this)}hostConnected(){this.host.addEventListener("input",this.onInput),this.host.addEventListener("change",this.onChange),this.host.addEventListener("oryx.select",this.onSelect)}hostDisconnected(){this.host.removeEventListener("input",this.onInput),this.host.removeEventListener("change",this.onChange),this.host.removeEventListener("oryx.select",this.onSelect)}hostUpdated(){this.host.querySelectorAll("oryx-option").forEach(t=>{t.toggleAttribute(x,!0),t.slot||(t.slot="option")}),!this.lastValue&&this.control.value&&(this.lastValue=this.control.value),this.onChange()}renderPopover(){return u`
      <oryx-popover>
        ${m(!this.host.isEmpty,()=>u`<slot name="option"></slot>`)}
        <slot name="empty">
          ${m(this.host.isEmpty,()=>u`<div class="placeholder">
                ${this.host.emptyMessage??V}
              </div>`)}
        </slot>
        <slot name="loading">
          ${m(this.host.isLoading,()=>u`<div class="placeholder">
                <oryx-spinner></oryx-spinner>
              </div>`)}
        </slot>
      </oryx-popover>
    `}onInput(){var o;const t=((o=this.typeaheadControl)==null?void 0:o.value)||this.control.value,e=new CustomEvent("oryx.typeahead",{detail:{query:t},bubbles:!0,composed:!0});this.host.dispatchEvent(e)}onChange(){const t=this.control.value;this.popoverController.selectByValue(t,this.lastValue===t),t===""&&(this.lastValue=void 0)}onSelect(t){if(t.detail.selected){const e=this.getValue(t.detail.selected),o=this.getText(t.detail.selected);if(!e)return;this.control.value=e,this.control.dispatchEvent(new Event(this.control instanceof HTMLSelectElement?"change":"input",{bubbles:!0,composed:!0})),o&&this.typeaheadControl&&(this.typeaheadControl.value=o)}}get control(){return v(this.host)}get typeaheadControl(){var t;return(t=this.host.renderRoot)==null?void 0:t.querySelector("[typeaheadInput]")}getValue(t){return t.value}getText(t){var e;return(e=t.innerText)==null?void 0:e.trim()}}var y;let s=(y=class extends C{constructor(){super(...arguments),this.typeaheadController=new B(this),this.formControlController=new b(this),this.searchController=new S(this)}render(){return u`
      ${this.formControlController.render({before:this.searchController.renderPrefix(),after:this.searchController.renderSuffix()})}
      ${this.typeaheadController.renderPopover()}
    `}},(()=>{y.styles=w})(),y);n([h(),l("design:type",String)],s.prototype,"filterStrategy",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"isLoading",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"isEmpty",void 0);n([h(),l("design:type",String)],s.prototype,"emptyMessage",void 0);n([h(),l("design:type",String)],s.prototype,"label",void 0);n([h(),l("design:type",String)],s.prototype,"errorMessage",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"hasError",void 0);n([h(),l("design:type",String)],s.prototype,"prefixIcon",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"prefixFill",void 0);n([h(),l("design:type",String)],s.prototype,"suffixIcon",void 0);n([h({type:Boolean}),l("design:type",Boolean)],s.prototype,"suffixFill",void 0);n([h(),l("design:type",String)],s.prototype,"searchIcon",void 0);n([h(),l("design:type",String)],s.prototype,"searchIconPosition",void 0);n([h(),l("design:type",String)],s.prototype,"clearIcon",void 0);n([h({reflect:!0}),l("design:type",String)],s.prototype,"clearIconPosition",void 0);n([h(),l("design:type",String)],s.prototype,"clearIconAppearance",void 0);s=n([E()],s);const H=Object.freeze(Object.defineProperty({__proto__:null,get TypeaheadComponent(){return s}},Symbol.toStringTag,{value:"Module"}));export{B as T,H as t};
