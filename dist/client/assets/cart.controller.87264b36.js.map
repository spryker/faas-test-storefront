{"version":3,"file":"cart.controller.87264b36.js","sources":["../../../node_modules/@spryker-oryx/cart/src/controllers/cart.controller.js"],"sourcesContent":["import { CartService } from '@spryker-oryx/cart';\nimport { resolve } from '@spryker-oryx/injector';\nimport { PricingService } from '@spryker-oryx/site';\nimport { ObserveController } from '@spryker-oryx/utilities/lit-rxjs';\nimport { combineLatest, filter, map, of, switchMap } from 'rxjs';\nexport class CartController {\n    constructor(host) {\n        this.host = host;\n        this.cartService = resolve(CartService);\n        this.pricingService = resolve(PricingService);\n        this.observe = new ObserveController(host);\n    }\n    /**\n     * Returns the cumulated quantities of all cart entries.\n     */\n    getTotalQuantity() {\n        return this.observe.get('cartId').pipe(switchMap((cartId) => this.cartService.getCart({ cartId })), map((cart) => this.cumulateQuantity(cart)));\n    }\n    getTotals() {\n        return this.observe.get('cartId').pipe(switchMap((cartId) => this.cartService.getCart({ cartId })), switchMap((cart) => cart?.products\n            ? of(cart).pipe(switchMap(() => combineLatest([\n                this.formatTotals(cart),\n                this.formatDiscounts(cart),\n                of({\n                    itemsQuantity: this.cumulateQuantity(cart),\n                    priceMode: cart.priceMode,\n                }),\n            ]).pipe(map(([calculations, discounts, details]) => ({\n                calculations,\n                ...(discounts && { discounts }),\n                ...details,\n            })))))\n            : of(null)));\n    }\n    /**\n     * Cumulates the quantities for all the cart entries.\n     */\n    cumulateQuantity(cart) {\n        return (cart?.products?.reduce((acc, { quantity }) => acc + quantity, 0) ?? null);\n    }\n    formatDiscounts(cart) {\n        return of(cart).pipe(switchMap((cart) => (cart.discounts ?? []).reduce((acc$, discount) => acc$.pipe(switchMap((acc) => this.pricingService.format(-discount.amount).pipe(filter((amount) => amount !== null), map((amount) => [...acc, { ...discount, amount }])))), of([]))));\n    }\n    /**\n     * Formats the cart totals by using the `PricingService.format()` method. The price\n     * formatting requires a lookup on the locale and currency, which is why this API is\n     * observable based.\n     */\n    formatTotals(cart) {\n        return of(cart).pipe(switchMap((cart) => Object.entries(cart.totals ?? {}).reduce((acc$, [priceType, price]) => {\n            return acc$.pipe(switchMap((acc) => {\n                if (!price) {\n                    return of({ ...acc });\n                }\n                if (priceType === 'discountTotal') {\n                    price = -price;\n                }\n                return this.pricingService.format(price).pipe(map((formattedPrice) => ({\n                    ...acc,\n                    [priceType]: formattedPrice,\n                })));\n            }));\n        }, of({}))));\n    }\n}\n//# sourceMappingURL=cart.controller.js.map"],"names":["CartController","host","resolve","CartService","PricingService","ObserveController","switchMap","cartId","map","cart","of","combineLatest","calculations","discounts","details","_b","_a","acc","quantity","acc$","discount","filter","amount","priceType","price","formattedPrice"],"mappings":"gJAKO,MAAMA,CAAe,CACxB,YAAYC,EAAM,CACd,KAAK,KAAOA,EACZ,KAAK,YAAcC,EAAQC,CAAW,EACtC,KAAK,eAAiBD,EAAQE,CAAc,EAC5C,KAAK,QAAU,IAAIC,EAAkBJ,CAAI,CAC5C,CAID,kBAAmB,CACf,OAAO,KAAK,QAAQ,IAAI,QAAQ,EAAE,KAAKK,EAAWC,GAAW,KAAK,YAAY,QAAQ,CAAE,OAAAA,CAAM,CAAE,CAAC,EAAGC,EAAKC,GAAS,KAAK,iBAAiBA,CAAI,CAAC,CAAC,CACjJ,CACD,WAAY,CACR,OAAO,KAAK,QAAQ,IAAI,QAAQ,EAAE,KAAKH,EAAWC,GAAW,KAAK,YAAY,QAAQ,CAAE,OAAAA,EAAQ,CAAC,EAAGD,EAAWG,GAASA,GAAA,MAAAA,EAAM,SACxHC,EAAGD,CAAI,EAAE,KAAKH,EAAU,IAAMK,EAAc,CAC1C,KAAK,aAAaF,CAAI,EACtB,KAAK,gBAAgBA,CAAI,EACzBC,EAAG,CACC,cAAe,KAAK,iBAAiBD,CAAI,EACzC,UAAWA,EAAK,SACpC,CAAiB,CACjB,CAAa,EAAE,KAAKD,EAAI,CAAC,CAACI,EAAcC,EAAWC,CAAO,KAAO,CACjD,aAAAF,EACA,GAAIC,GAAa,CAAE,UAAAA,GACnB,GAAGC,CACnB,EAAc,CAAC,CAAC,CAAC,EACHJ,EAAG,IAAI,CAAC,CAAC,CAClB,CAID,iBAAiBD,EAAM,SACnB,OAAQM,GAAAC,EAAAP,GAAA,YAAAA,EAAM,WAAN,YAAAO,EAAgB,OAAO,CAACC,EAAK,CAAE,SAAAC,CAAU,IAAKD,EAAMC,EAAU,KAA9D,KAAAH,EAAoE,IAC/E,CACD,gBAAgBN,EAAM,CAClB,OAAOC,EAAGD,CAAI,EAAE,KAAKH,EAAWG,UAAU,QAAAO,EAAAP,EAAK,YAAL,KAAAO,EAAkB,IAAI,OAAO,CAACG,EAAMC,IAAaD,EAAK,KAAKb,EAAWW,GAAQ,KAAK,eAAe,OAAO,CAACG,EAAS,MAAM,EAAE,KAAKC,EAAQC,GAAWA,IAAW,IAAI,EAAGd,EAAKc,GAAW,CAAC,GAAGL,EAAK,CAAE,GAAGG,EAAU,OAAAE,CAAM,CAAE,CAAC,CAAC,CAAC,CAAC,EAAGZ,EAAG,CAAA,CAAE,CAAC,EAAC,CAAC,CACjR,CAMD,aAAaD,EAAM,CACf,OAAOC,EAAGD,CAAI,EAAE,KAAKH,EAAWG,GAAS,OAAA,cAAO,SAAQO,EAAAP,EAAK,SAAL,KAAAO,EAAe,CAAE,CAAA,EAAE,OAAO,CAACG,EAAM,CAACI,EAAWC,CAAK,IAC/FL,EAAK,KAAKb,EAAWW,GACnBO,GAGDD,IAAc,kBACdC,EAAQ,CAACA,GAEN,KAAK,eAAe,OAAOA,CAAK,EAAE,KAAKhB,EAAKiB,IAAoB,CACnE,GAAGR,EACH,CAACM,GAAYE,CAChB,EAAC,CAAC,GARQf,EAAG,CAAE,GAAGO,CAAG,CAAE,CAS3B,CAAC,EACHP,EAAG,CAAA,CAAE,CAAC,EAAC,CAAC,CACd,CACL"}