import{y as u,K as g,d as v,_ as n,v as r,g as h,h as C}from"./index-4d2c92b7.js";import"./input.styles-6d634215.js";import{F as E}from"./input.component-77513b1c.js";import{S as b}from"./searchbox.controller-e0fbc498.js";import{baseStyles as S}from"./typeahead.styles-f3f9a55e.js";import"./searchbox.styles-887a8527.js";import"./common-0ee98dc0.js";import"./popover.component-907eb365.js";import{P as w,C as I}from"./popover.model-91d12e3a.js";import{g as m}from"./getControl-ea6b3b29.js";import{P as _}from"./popover.controller-b201d380.js";function f(s,t,e,o){return o.includes(s.charAt(t))&&s.charAt(t)!==e.substring(0,1)}function x(s,t,e,o){let p="";if(s.length>0&&s[0]>-1){let l=s[0];f(t,l,e,o.delimiters)&&l++,p+=`${t.substring(0,l)}`}p+=s.map((l,d)=>{let c="";if(l!==void 0){f(t,l,e,o.delimiters)&&l++,c+=`<mark>${t.substring(l,l+e.length)}</mark>`;let y=s[d+1];f(t,y,e,o.delimiters)&&y++,y>-1&&(c+=t.substring(l+e.length,y))}return c}).join("");let a=s[s.length-1];return a!==void 0&&(f(t,a,e,o.delimiters)&&a++,p+=t.substring(a+e.length)),p}function L(s,t){const e=(t.delimiters.indexOf(s.charAt(0))>-1?[]:[...t.delimiters]).join("|");let o;switch(t.type){case"start_of_word":o=`(?:^|${e})${s}`;break;case"start_with":o=`^(${e})?${s}`;break;case"contains":o=`[.]*${s}`;break}return new RegExp(o,"gi")}class O{constructor(t){this.host=t,this.strategies={start_of_word:{type:"start_of_word",delimiters:[" ","/","-","_"]},start_with:{type:"start_with",delimiters:["/"]},contains:{type:"contains",delimiters:[]}},this.host.addController(this),this.onKeydown=this.onKeydown.bind(this),this.onInput=this.onInput.bind(this),this.onFocusOut=this.onFocusOut.bind(this),this.onChange=this.onChange.bind(this)}hostConnected(){this.host.addEventListener("keydown",this.onKeydown),this.host.addEventListener("input",this.onInput),this.host.addEventListener("focusout",this.onFocusOut),this.host.addEventListener("change",this.onChange)}hostDisconnected(){this.host.removeEventListener("keydown",this.onKeydown),this.host.removeEventListener("input",this.onInput),this.host.removeEventListener("focusout",this.onFocusOut),this.host.removeEventListener("change",this.onChange)}onKeydown(t){this.host.filterStrategy&&t.key===" "&&this.controlItem.value===""&&t.preventDefault()}onFocusOut(){this.host.filterStrategy&&(this.items.find(e=>e.selected)||this.clearInput())}onInput(t){this.host.filterStrategy&&t.inputType&&this.filterOptionsByValue(t.inputType==="deleteContentBackward"&&!this.controlItem.value?"":this.controlItem.value)}hostUpdated(){this.host.filterStrategy&&this.filterValue&&this.filterOptionsByValue(this.controlItem.value)}clearInput(){this.control&&(this.control.value="",this.host.filterStrategy&&this.filterOptionsByValue(this.control.value),this.control.dispatchEvent(new Event(this.control instanceof HTMLSelectElement?"change":"input",{bubbles:!0,composed:!0})))}setEmptyState(t){const e=!!this.host.isEmpty;e!==t&&(this.host.isEmpty=t,this.host.requestUpdate("isEmpty",e))}onChange(){this.filterValue!==this.controlItem.value&&this.filterOptions("",!0)}filterOptions(t="",e){if(!this.host.filterStrategy)return;let o=0;const p=this.strategies[this.host.filterStrategy];this.items.forEach(a=>{const l=a.innerText||a.value;if(l){const d=[...l.matchAll(L(t,p))].map(c=>c.index);a.toggleAttribute("hide",d.length===0),a.hasAttribute("hide")||(a.innerHTML=x(d,l,t,p),o++)}}),e||this.dispatchMatchEvent(o,t),this.setEmptyState(o===0)}filterOptionsByValue(t=""){this.filterValue===t||!this.filterValue&&t===""||(this.filterValue=t,this.filterOptions(t))}dispatchMatchEvent(t,e){let o;if(t===1){const a=this.items.find(d=>!d.hasAttribute("hide"));(a?.innerText?.trim()||a?.value||"").toLowerCase()===e.toLowerCase()&&(o=a)}const p=new CustomEvent(w,{detail:{selected:o},bubbles:!0,composed:!0});this.control.dispatchEvent(p)}get control(){return m(this.host,"input, select")}get filterControl(){return this.host.renderRoot.querySelector("[filterInput]")}get controlItem(){return this.host.hasAttribute("filterSelect")?this.filterControl:this.control}get items(){return Array.from(this.host.querySelectorAll("oryx-option"))}}const T="No results found";class V{constructor(t,e){this.host=t,this.options=e,this.host.addController(this),this.filterController=new O(t),this.popoverController=new _(t,e),this.onInput=this.onInput.bind(this),this.onChange=this.onChange.bind(this),this.onSelect=this.onSelect.bind(this)}hostConnected(){this.host.addEventListener("input",this.onInput),this.host.addEventListener("change",this.onChange),this.host.addEventListener("oryx.select",this.onSelect)}hostDisconnected(){this.host.removeEventListener("input",this.onInput),this.host.removeEventListener("change",this.onChange),this.host.removeEventListener("oryx.select",this.onSelect)}hostUpdated(){this.host.querySelectorAll("oryx-option").forEach(t=>{t.toggleAttribute(I,!0),t.slot||(t.slot="option")}),!this.lastValue&&this.control.value&&(this.lastValue=this.control.value),this.onChange()}renderPopover(){return u`
      <oryx-popover>
        ${g(!this.host.isEmpty,()=>u`<slot name="option"></slot>`)}
        <slot name="empty">
          ${g(this.host.isEmpty,()=>u`<div class="placeholder">
                ${this.host.emptyMessage??T}
              </div>`)}
        </slot>
        <slot name="loading">
          ${g(this.host.isLoading,()=>u`<div class="placeholder">
                <oryx-spinner></oryx-spinner>
              </div>`)}
        </slot>
      </oryx-popover>
    `}onInput(){const t=this.typeaheadControl?.value||this.control.value,e=new CustomEvent("oryx.typeahead",{detail:{query:t},bubbles:!0,composed:!0});this.host.dispatchEvent(e)}onChange(){const t=this.control.value;this.popoverController.selectByValue(t,this.lastValue===t),t===""&&(this.lastValue=void 0)}onSelect(t){if(t.detail.selected){const e=this.getValue(t.detail.selected),o=this.getText(t.detail.selected);if(!e)return;this.control.value=e,this.control.dispatchEvent(new Event(this.control instanceof HTMLSelectElement?"change":"input",{bubbles:!0,composed:!0})),o&&this.typeaheadControl&&(this.typeaheadControl.value=o)}}get control(){return m(this.host)}get typeaheadControl(){return this.host.renderRoot?.querySelector("[typeaheadInput]")}getValue(t){return t.value}getText(t){return t.innerText?.trim()}}let i=class extends v{constructor(){super(...arguments),this.typeaheadController=new V(this),this.formControlController=new E(this),this.searchController=new b(this)}static{this.styles=S}render(){return u`
      ${this.formControlController.render({before:this.searchController.renderPrefix(),after:this.searchController.renderSuffix()})}
      ${this.typeaheadController.renderPopover()}
    `}};n([r(),h("design:type",String)],i.prototype,"filterStrategy",void 0);n([r({type:Boolean}),h("design:type",Boolean)],i.prototype,"isLoading",void 0);n([r({type:Boolean}),h("design:type",Boolean)],i.prototype,"isEmpty",void 0);n([r(),h("design:type",String)],i.prototype,"emptyMessage",void 0);n([r(),h("design:type",String)],i.prototype,"label",void 0);n([r(),h("design:type",String)],i.prototype,"errorMessage",void 0);n([r({type:Boolean}),h("design:type",Boolean)],i.prototype,"hasError",void 0);n([r(),h("design:type",String)],i.prototype,"prefixIcon",void 0);n([r({type:Boolean}),h("design:type",Boolean)],i.prototype,"prefixFill",void 0);n([r(),h("design:type",String)],i.prototype,"suffixIcon",void 0);n([r({type:Boolean}),h("design:type",Boolean)],i.prototype,"suffixFill",void 0);n([r(),h("design:type",String)],i.prototype,"searchIcon",void 0);n([r(),h("design:type",String)],i.prototype,"searchIconPosition",void 0);n([r(),h("design:type",String)],i.prototype,"clearIcon",void 0);n([r({reflect:!0}),h("design:type",String)],i.prototype,"clearIconPosition",void 0);n([r(),h("design:type",String)],i.prototype,"clearIconAppearance",void 0);i=n([C()],i);const H=Object.freeze(Object.defineProperty({__proto__:null,get TypeaheadComponent(){return i}},Symbol.toStringTag,{value:"Module"}));export{V as T,H as t};
