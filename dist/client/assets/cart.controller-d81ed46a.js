import{r as p,a7 as m,ah as c,l as s,m as n,o,j as h,A as v}from"./index-41c5945f.js";import{O as f}from"./content.controller-bfde8771.js";class C{constructor(e){this.host=e,this.cartService=p(m),this.pricingService=p(c),this.observe=new f(e)}getTotalQuantity(){return this.observe.get("cartId").pipe(s(e=>this.cartService.getCart({cartId:e})),n(e=>this.cumulateQuantity(e)))}getTotals(){return this.observe.get("cartId").pipe(s(e=>this.cartService.getCart({cartId:e})),s(e=>e!=null&&e.products?o(e).pipe(s(()=>h([this.formatTotals(e),this.formatDiscounts(e),o({itemsQuantity:this.cumulateQuantity(e),priceMode:e.priceMode})]).pipe(n(([i,r,t])=>({calculations:i,...r&&{discounts:r},...t}))))):o(null)))}cumulateQuantity(e){var i;return((i=e==null?void 0:e.products)==null?void 0:i.reduce((r,{quantity:t})=>r+t,0))??null}formatDiscounts(e){return o(e).pipe(s(i=>(i.discounts??[]).reduce((r,t)=>r.pipe(s(a=>this.pricingService.format(-t.amount).pipe(v(u=>u!==null),n(u=>[...a,{...t,amount:u}])))),o([]))))}formatTotals(e){return o(e).pipe(s(i=>Object.entries(i.totals??{}).reduce((r,[t,a])=>r.pipe(s(u=>a?(t==="discountTotal"&&(a=-a),this.pricingService.format(a).pipe(n(l=>({...u,[t]:l})))):o({...u}))),o({}))))}}export{C};
