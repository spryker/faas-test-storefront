import{r as p,a7 as l,ah as m,l as r,m as n,o as i,j as h,A as v}from"./index-4d2c92b7.js";import{O as f}from"./content.controller-33ee67c3.js";class C{constructor(t){this.host=t,this.cartService=p(l),this.pricingService=p(m),this.observe=new f(t)}getTotalQuantity(){return this.observe.get("cartId").pipe(r(t=>this.cartService.getCart({cartId:t})),n(t=>this.cumulateQuantity(t)))}getTotals(){return this.observe.get("cartId").pipe(r(t=>this.cartService.getCart({cartId:t})),r(t=>t?.products?i(t).pipe(r(()=>h([this.formatTotals(t),this.formatDiscounts(t),i({itemsQuantity:this.cumulateQuantity(t),priceMode:t.priceMode})]).pipe(n(([s,e,a])=>({calculations:s,...e&&{discounts:e},...a}))))):i(null)))}cumulateQuantity(t){return t?.products?.reduce((s,{quantity:e})=>s+e,0)??null}formatDiscounts(t){return i(t).pipe(r(s=>(s.discounts??[]).reduce((e,a)=>e.pipe(r(o=>this.pricingService.format(-a.amount).pipe(v(u=>u!==null),n(u=>[...o,{...a,amount:u}])))),i([]))))}formatTotals(t){return i(t).pipe(r(s=>Object.entries(s.totals??{}).reduce((e,[a,o])=>e.pipe(r(u=>o?(a==="discountTotal"&&(o=-o),this.pricingService.format(o).pipe(n(c=>({...u,[a]:c})))):i({...u}))),i({}))))}}export{C};
