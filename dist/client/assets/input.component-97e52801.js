import{y as l,d as b,_ as o,v as i,g as n}from"./index-74abacf3.js";import{q as u,i as g}from"./query.util-ea16e59e.js";import{b as p}from"./input.styles-234f9c42.js";import{g as v}from"./getControl-b5e3af75.js";class m{constructor(t){this.host=t,this.host.addController(this)}hostUpdated(){this.updateFill()}renderPrefix(t){if(t)this.host.setAttribute("has-prefix","");else{const e=this.host.prefixIcon;this.hasContent("prefix",e)&&(t=l`<oryx-icon .type="${e}"></oryx-icon>`,this.host.setAttribute("has-prefix",""))}return this.renderContent("prefix",t)}renderSuffix(t){let e;const s=this.host.suffixIcon;return this.hasContent("suffix",s)&&(e=l`<oryx-icon .type="${s}"></oryx-icon>`),this.renderContent("suffix",l`${t}${e}`)}renderContent(t,e){return l`<slot name=${t}>${e}</slot>`}updateFill(){var t,e;this.host.toggleAttribute("prefixFill",!!this.host.prefixFill&&(!!this.host.prefixIcon||((t=u(this.host,{slot:"prefix",flatten:!0}))==null?void 0:t.length)>0)),this.host.toggleAttribute("suffixFill",!!this.host.suffixFill&&(!!this.host.suffixIcon||((e=u(this.host,{slot:"suffix",flatten:!0}))==null?void 0:e.length)>0))}hasContent(t,e){var s,h,a;return!!e||((a=(h=(s=this.host)==null?void 0:s.querySelectorAll)==null?void 0:h.call(s,`*[slot=${t}]`))==null?void 0:a.length)>0}}class y{constructor(t){this.host=t,this.host.addController(this)}hostUpdated(){this.handleError()}render(){return l`<oryx-error-message .message=${this.message}>
      <slot name="error" @slotchange=${this.handleError.bind(this)}></slot>
    </oryx-error-message>`}handleError(){const t=!!this.message||this.errorSlot.length>0,e=this.host.shadowRoot.querySelector("oryx-error-message"),s=e==null?void 0:e.hasAttribute("hasErrorContent");e==null||e.toggleAttribute("hasErrorContent",t),(!this.host.hasAttribute("hasError")||s)&&this.host.toggleAttribute("hasError",t)}get message(){return this.host.errorMessage}get errorSlot(){return this.host.querySelectorAll("[slot=error]")}}const E=["a[href]","button","[tabindex]","input","select","textarea"];class A{constructor(t){this.host=t,this.host.addController(this)}hostConnected(){this.setupVisibleFocusHandlers()}setupVisibleFocusHandlers(){const t=()=>{this.mouseWasUsed=void 0,this.host.removeAttribute("visible-focus"),this.focusableElements().forEach(e=>{e.removeEventListener("blur",t)})};this.host.addEventListener("mousedown",()=>{this.mouseWasUsed=!0,this.host.removeAttribute("visible-focus"),this.focusableElements().forEach(e=>{e.addEventListener("blur",()=>t())})}),this.host.addEventListener("keyup",()=>{this.mouseWasUsed||this.host.toggleAttribute("visible-focus",!0),this.focusableElements().forEach(e=>{e.addEventListener("blur",()=>t())})})}focusableElements(){return u(this.host,{selector:E.join(","),flatten:!0})}}class x{constructor(t){this.host=t,this._attributes=["disabled","readonly"],this._listeners=[],this.host.addController(this),this.visibleFocusController=new A(this.host),this.errorController=new y(this.host),this.mouseDownHandler=this.mouseDownHandler.bind(this),this.setHasErrorAttr=this.setHasErrorAttr.bind(this),this.removeHasErrorAttr=this.removeHasErrorAttr.bind(this)}hostConnected(){this.host.addEventListener("mousedown",this.mouseDownHandler)}hostUpdated(){const t=this.host.renderRoot.querySelector('slot[name="prefix"]');this.host.style.setProperty("--float-label-start-gap",`${t==null?void 0:t.offsetWidth}px`)}hostDisconnected(){var t;this.removeValidationListeners(),this.host.removeEventListener("mousedown",this.mouseDownHandler),(t=this.controlAttrObserver)==null||t.disconnect()}mouseDownHandler(t){g(t.target)||(t.target===this.host&&t.preventDefault(),this.control.focus())}render(t={}){return l`
      <label>
        <slot name="label" part="label">${this.host.label}</slot>
        <div class="control">
          ${t.before}
          <slot
            @slotchange=${()=>this.handleSlotChange()}
            @input=${()=>this.toggleHasValueAttribute()}
          >
            <input />
          </slot>
          ${t.after}
        </div>
      </label>
      ${this.errorController.render()}
    `}handleSlotChange(){this.detectAutofill(),this.toggleHasValueAttribute(),this.adjustDisabledState(),this.addValidationListeners()}setHasErrorAttr(){this.host.toggleAttribute("hasError",!0)}removeHasErrorAttr(){this.host.toggleAttribute("hasError",!1)}addValidationListeners(){var t,e;(t=this.control)==null||t.addEventListener("invalid",this.setHasErrorAttr),(e=this.control)==null||e.addEventListener("input",this.removeHasErrorAttr)}removeValidationListeners(){var t,e;(t=this.control)==null||t.removeEventListener("invalid",this.setHasErrorAttr),(e=this.control)==null||e.removeEventListener("input",this.removeHasErrorAttr)}detectAutofill(){let t=30;const e=setInterval(()=>{t===0&&clearInterval(e),t--;try{this.control.matches(":-webkit-autofill")&&(this.host.toggleAttribute("has-value",!0),clearInterval(e))}catch{clearInterval(e)}},30)}toggleHasValueAttribute(){this.host.toggleAttribute("has-value",!!this.control.value)}adjustDisabledState(){this.host.toggleAttribute("disabled",this.control.disabled),this.registerListener({attributes:["disabled","readonly"]},()=>{this.host.toggleAttribute("disabled",this.control.disabled)})}registerListener(t,e){var s;this._attributes=[...this._attributes,...t.attributes],this._listeners.push(e),(s=this.controlAttrObserver)==null||s.disconnect(),this.controlAttrObserver=new MutationObserver((h,a)=>{this._listeners.forEach(f=>f(h,a))}),this.controlAttrObserver.observe(this.control,{attributeFilter:this._attributes})}get control(){return v(this.host)}}const c=class extends b{constructor(){super(...arguments),this.formControlController=new x(this),this.affixController=new m(this)}render(){return l`${this.formControlController.render({before:this.affixController.renderPrefix(),after:this.affixController.renderSuffix()})}`}};let r=c;(()=>{c.styles=p})();o([i({type:Boolean,reflect:!0}),n("design:type",Boolean)],r.prototype,"floatLabel",void 0);o([i(),n("design:type",String)],r.prototype,"label",void 0);o([i(),n("design:type",String)],r.prototype,"errorMessage",void 0);o([i({type:Boolean,reflect:!0}),n("design:type",Boolean)],r.prototype,"hasError",void 0);o([i(),n("design:type",String)],r.prototype,"prefixIcon",void 0);o([i({type:Boolean,reflect:!0}),n("design:type",Boolean)],r.prototype,"prefixFill",void 0);o([i(),n("design:type",String)],r.prototype,"suffixIcon",void 0);o([i({type:Boolean,reflect:!0}),n("design:type",Boolean)],r.prototype,"suffixFill",void 0);const $=Object.freeze(Object.defineProperty({__proto__:null,InputComponent:r},Symbol.toStringTag,{value:"Module"}));export{m as A,y as E,x as F,$ as i};
